(()=>{"use strict";var e,t={332(){async function e(e,t={}){const n=new FormData;n.append("action",e),n.append("nonce",window.apprcoAjax?.nonce||""),Object.keys(t).forEach(e=>{n.append(e,t[e])});try{const e=await fetch(window.apprcoAjax?.ajaxurl||"/wp-admin/admin-ajax.php",{method:"POST",body:n,credentials:"same-origin"}),t=await e.json();if(!t.success)throw new Error(t.data||"Request failed");return t.data}catch(e){throw console.error("AJAX Error:",e),e}}function t(){return window.apprcoAjax?.strings||{}}function n(e,t="success"){document.querySelectorAll(".apprco-notice").forEach(e=>e.remove());const n=document.createElement("div");n.className=`apprco-notice apprco-notice-${t}`,n.textContent=e;const o=document.querySelector(".wrap h1");o&&o.insertAdjacentElement("afterend",n),setTimeout(()=>{n.style.opacity="0",n.style.transition="opacity 0.3s ease",setTimeout(()=>n.remove(),300)},5e3)}function o(e){n(e instanceof Error?e.message:e,"error")}async function c(c){c.preventDefault();const a=c.currentTarget,r=a.textContent,s=t();try{a.disabled=!0,a.textContent=s.syncing||"Syncing...",n((await e("apprco_manual_sync")).message,"success"),setTimeout(()=>{window.location.reload()},2e3)}catch(e){o(e)}finally{a.disabled=!1,a.textContent=r}}async function a(n){n.preventDefault();const o=n.currentTarget,c=o.textContent,a=document.getElementById("apprco-dashboard-result"),r=t();try{o.disabled=!0,o.textContent=r.syncing||"Syncing...",a&&(a.innerHTML=`<span class="apprco-loading">${r.loading||"Loading..."}</span>`);const t=await e("apprco_manual_sync");a&&(a.className="success",a.innerHTML=t.message),setTimeout(()=>{window.location.reload()},2e3)}catch(e){a&&(a.className="error",a.innerHTML=e.message)}finally{o.disabled=!1,o.textContent=c}}async function r(t){t.preventDefault();const n=t.currentTarget,o=n.textContent,c=document.getElementById("apprco-test-sync-result"),a=document.getElementById("api_base_url")?.value,r=document.getElementById("api_subscription_key")?.value,s=document.getElementById("api_ukprn")?.value;try{n.disabled=!0,n.textContent="Testing & Syncing...",c&&(c.innerHTML='<p style="color: #2271b1;">Testing API connection and syncing vacancies...</p>');const t=await e("apprco_test_and_sync",{api_base_url:a,api_subscription_key:r,api_ukprn:s});c&&(c.className="success",c.innerHTML=`<p>${t.message}</p>`);const o=document.getElementById("apprco-last-sync"),i=document.getElementById("apprco-total-vacancies");o&&(o.textContent=t.last_sync),i&&(i.textContent=t.total_vacancies),await e("apprco_save_api_settings",{api_base_url:a,api_subscription_key:r,api_ukprn:s})}catch(e){c&&(c.className="error",c.innerHTML=`<p>Error: ${e.message}</p>`)}finally{n.disabled=!1,n.textContent=o}}async function s(c){c.preventDefault();const a=c.currentTarget,r=a.textContent,s=t();try{a.disabled=!0,a.textContent=s.testing||"Testing...",n(await e("apprco_test_api"),"success")}catch(e){o(e)}finally{a.disabled=!1,a.textContent=r}}async function i(t){t.preventDefault();const c=t.currentTarget,a=c.textContent;try{c.disabled=!0,c.textContent="Clearing...",n(await e("apprco_clear_cache"),"success")}catch(e){o(e)}finally{c.disabled=!1,c.textContent=a}}window.wp.apiFetch,document.addEventListener("DOMContentLoaded",()=>{!function(){const e=document.getElementById("apprco-manual-sync");e&&e.addEventListener("click",c);const t=document.getElementById("apprco-dashboard-sync");t&&t.addEventListener("click",a);const n=document.getElementById("apprco-test-and-sync");n&&n.addEventListener("click",r)}(),function(){const e=document.getElementById("apprco-test-api");e&&e.addEventListener("click",s)}(),function(){const e=document.getElementById("apprco-clear-cache");e&&e.addEventListener("click",i)}(),document.querySelector(".apprco-logs")&&(document.addEventListener("click",async n=>{if(!n.target.classList.contains("apprco-view-logs"))return;n.preventDefault();const o=n.target.dataset.importId,c=document.getElementById("apprco-log-details"),a=document.getElementById("apprco-log-entries"),r=document.getElementById("apprco-log-import-id"),s=t();a&&(a.innerHTML=`<p>${s.loading||"Loading..."}</p>`),c&&(c.style.display="block"),r&&(r.textContent=o);try{const t=await e("apprco_get_logs",{import_id:o});if(t&&t.length>0&&a){const e=t.map(e=>`\n\t\t\t\t\t<div class="apprco-log-entry ${e.log_level}">\n\t\t\t\t\t\t<span class="log-time">${e.created_at}</span>\n\t\t\t\t\t\t<span class="log-level">${e.log_level}</span>\n\t\t\t\t\t\t<span class="log-message">${e.message}</span>\n\t\t\t\t\t</div>\n\t\t\t\t`).join("");a.innerHTML=e}else a&&(a.innerHTML="<p>No log entries found for this import.</p>")}catch(e){a&&(a.innerHTML="<p>Error loading logs.</p>")}}),function(){const e=document.getElementById("apprco-close-logs");e&&e.addEventListener("click",()=>{const e=document.getElementById("apprco-log-details");e&&(e.style.display="none")})}(),function(){const e=document.getElementById("apprco-refresh-logs");e&&e.addEventListener("click",()=>{window.location.reload()})}(),function(){const t=document.getElementById("apprco-export-logs");t&&t.addEventListener("click",async t=>{t.preventDefault();try{const t=await e("apprco_export_logs"),n=new Blob([t.csv],{type:"text/csv"}),o=window.URL.createObjectURL(n),c=document.createElement("a");c.href=o,c.download=`apprco-logs-${(new Date).toISOString().slice(0,10)}.csv`,document.body.appendChild(c),c.click(),window.URL.revokeObjectURL(o),document.body.removeChild(c)}catch(e){o(e)}})}(),function(){const c=document.getElementById("apprco-clear-logs");c&&c.addEventListener("click",async c=>{c.preventDefault();const a=t();if(!confirm(a.confirm_clear||"Are you sure?"))return;const r=c.currentTarget;r.disabled=!0;try{n(await e("apprco_clear_logs"),"success"),setTimeout(()=>{window.location.reload()},1500)}catch(e){o(e),r.disabled=!1}})}()),document.querySelector(".apprco-setup-progress")&&(document.querySelectorAll(".apprco-setup-step input, .apprco-setup-step select, .apprco-setup-step textarea").forEach(e=>{e.addEventListener("change",()=>{const t=e.closest("form");if(t){const e=new FormData(t),n=Object.fromEntries(e.entries());localStorage.setItem("apprco_setup_form_data",JSON.stringify(n))}})}),function(){const e=localStorage.getItem("apprco_setup_form_data");if(e){try{const t=JSON.parse(e),n=document.querySelector(".apprco-setup-step form");n&&Object.entries(t).forEach(([e,t])=>{if("step"===e||"apprco_setup_nonce"===e||"_wp_http_referer"===e)return;const o=n.querySelector(`[name="${e}"]`);o&&("checkbox"===o.type?o.checked="1"===t:o.value=t)})}catch(e){console.error("Error restoring form data:",e)}window.location.search.includes("step=5")&&localStorage.removeItem("apprco_setup_form_data")}}(),function(){const e=document.getElementById("create_page");if(e){e.addEventListener("change",e=>{const t=e.target.checked,n=document.getElementById("page_title"),o=document.getElementById("page_slug");n&&(n.disabled=!t),o&&(o.disabled=!t)});const t=e.checked,n=document.getElementById("page_title"),o=document.getElementById("page_slug");n&&(n.disabled=!t),o&&(o.disabled=!t)}}(),function(){const e=document.getElementById("show_no_vacancy_image");if(e){const t=()=>{const t=document.getElementById("no_vacancy_image"),n=document.getElementById("no_vacancy_image_button"),o=e.checked;t&&(t.disabled=!o),n&&(n.disabled=!o)};e.addEventListener("change",t),t()}}(),function(){const e=document.querySelector(".apprco-setup-step form");e&&(window.onbeforeunload=()=>"Are you sure you want to leave? Your progress will be saved.",e.addEventListener("submit",()=>{window.onbeforeunload=null}),document.querySelectorAll(".apprco-setup-actions a").forEach(e=>{e.addEventListener("click",()=>{window.onbeforeunload=null})}))}()),document.querySelectorAll("form").forEach(e=>{e.addEventListener("submit",t=>{const o=e.querySelectorAll("[required]");let c=!0;o.forEach(e=>{e.value.trim()?e.classList.remove("error"):(e.classList.add("error"),c=!1)}),c||(t.preventDefault(),n("Please fill in all required fields.","error"))})}),document.querySelectorAll("input, select, textarea").forEach(e=>{e.addEventListener("input",()=>{e.classList.remove("error")}),e.addEventListener("change",()=>{e.classList.remove("error")})}),document.querySelectorAll(".apprco-shortcode-inline code").forEach(e=>{e.addEventListener("click",async()=>{const t=e.textContent;try{if(navigator.clipboard)await navigator.clipboard.writeText(t);else{const e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}!function(e){const t=e.textContent,n=e.style.background,o=e.style.color;e.textContent="Copied!",e.style.background="#46b450",e.style.color="#fff",setTimeout(()=>{e.textContent=t,e.style.background=n,e.style.color=o},2e3)}(e)}catch(e){console.error("Failed to copy:",e)}})}),function(){const e=document.getElementById("no_vacancy_image_button");e&&e.addEventListener("click",e=>{if(e.preventDefault(),"undefined"==typeof wp||void 0===wp.media)return void alert("Media uploader not available");const t=document.getElementById("no_vacancy_image"),n=wp.media({title:"Select No Vacancy Image",button:{text:"Use this image"},multiple:!1});n.on("select",()=>{const e=n.state().get("selection").first().toJSON();t&&(t.value=e.url)}),n.open()})}()})}},n={};function o(e){var c=n[e];if(void 0!==c)return c.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.m=t,e=[],o.O=(t,n,c,a)=>{if(!n){var r=1/0;for(d=0;d<e.length;d++){for(var[n,c,a]=e[d],s=!0,i=0;i<n.length;i++)(!1&a||r>=a)&&Object.keys(o.O).every(e=>o.O[e](n[i]))?n.splice(i--,1):(s=!1,a<r&&(r=a));if(s){e.splice(d--,1);var l=c();void 0!==l&&(t=l)}}return t}a=a||0;for(var d=e.length;d>0&&e[d-1][2]>a;d--)e[d]=e[d-1];e[d]=[n,c,a]},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={884:0,15:0};o.O.j=t=>0===e[t];var t=(t,n)=>{var c,a,[r,s,i]=n,l=0;if(r.some(t=>0!==e[t])){for(c in s)o.o(s,c)&&(o.m[c]=s[c]);if(i)var d=i(o)}for(t&&t(n);l<r.length;l++)a=r[l],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(d)},n=globalThis.webpackChunkapprenticeship_connect=globalThis.webpackChunkapprenticeship_connect||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var c=o.O(void 0,[15],()=>o(332));c=o.O(c)})();